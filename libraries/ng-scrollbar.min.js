"use strict";angular.module("ngScrollbar",[]).directive("ngScrollbar",["$parse","$window",function(e,t){return{restrict:"A",replace:!0,transclude:!0,scope:{showYScrollbar:"=?isBarShown"},link:function(e,o,n){var i,a,r,s,l,h,c,p,u,g,d,v={bottom:n.hasOwnProperty("bottom")},m=angular.element(t),b=!!m[0].addEventListener,w=!!m[0].removeEventListener,M={top:0},x={top:0},$=function(){c={position:"relative",overflow:"hidden","max-width":"100%",height:"100%"},x.height&&(c.height=x.height+"px"),p={position:"absolute",height:M.height+"px",top:M.top+"px"},u={position:"relative","line-height":M.height+"px"},g={position:"relative",top:x.top+"px",overflow:"hidden"}},I=function(){s.css("top",M.top+"px");var e=M.top/x.height;x.top=-Math.round(x.scrollHeight*e),a.css("top",x.top+"px")},Y=function(e){var t=e.hasOwnProperty("offsetY")?e.offsetY:e.layerY,o=Math.max(0,Math.min(parseInt(M.trackHeight,10)-parseInt(M.height,10),t));M.top=o,I(),e.stopPropagation()},E=function(e){var t=40,o=e,n=o.detail,i=o.wheelDelta,a=225,r=a-1;return n=n?i&&(f=i/n)?n/f:-n/1.35:i/120,n=1>n?-1>n?(-Math.pow(n,2)-r)/a:n:(Math.pow(n,2)+r)/a,e.delta=Math.min(Math.max(n/2,-1),1),e.delta=e.delta*t,M.top=Math.max(0,Math.min(parseInt(x.height,10)-parseInt(M.height,10),parseInt(M.top,10)-e.delta)),I(),e.preventDefault?void e.preventDefault():!1},H=0,S=function(e,t,o){M.top=Math.max(0,Math.min(parseInt(M.trackHeight,10)-parseInt(M.height,10),o)),e.stopPropagation()},T=function(e){var t=0,o=e.pageY-s[0].scrollTop-H;S(e,t,o),I()},O=function(e){m.off("mousemove",T),m.off("mouseup",O),e.stopPropagation()},k=function(e){var t=0,o=e.originalEvent.changedTouches[0].pageY-s[0].scrollTop-H;S(e,t,o),I()},y=function(e){m.off("touchmove",k),m.off("touchend",y),e.stopPropagation()},D=function(e){var t=void 0!==m[0].onmousewheel?"mousewheel":"DOMMouseScroll";b?e.addEventListener(t,E,!1):e.attachEvent("onmousewheel",E)},P=function(e){var t=void 0!==m[0].onmousewheel?"mousewheel":"DOMMouseScroll";w?e.removeEventListener(t,E,!1):e.detachEvent("onmousewheel",E)},L=function(t){t=v.bottom||t,i=angular.element(o.children()[0]),a=angular.element(i.children()[0]),r=angular.element(i.children()[1]),s=angular.element(angular.element(r.children()[0]).children()[0]),l=angular.element(s.children()[0]),h=angular.element(angular.element(r.children()[0]).children()[1]),x.height=o[0].offsetHeight,x.scrollHeight=a[0].scrollHeight,x.height<x.scrollHeight?(e.showYScrollbar=!0,e.$emit("scrollbar.show"),M.height=Math.round(x.height/x.scrollHeight*x.height),M.trackHeight=x.height,$(),o.css({overflow:"hidden"}),i.css(c),a.css(g),s.css(p),l.css(u),h.bind("click",Y),D(a[0]),s.on("mousedown",function(e){H=e.pageY-s[0].offsetTop,m.on("mouseup",O),m.on("mousemove",T),e.preventDefault()}),s.on("touchstart",function(e){H=e.originalEvent.changedTouches[0].pageY-s[0].offsetTop,m.on("touchend",y),m.on("touchmove",k),e.preventDefault()}),t?(v.bottom=!1,M.top=parseInt(x.height,10)-parseInt(M.height,10)):M.top=Math.max(0,Math.min(parseInt(x.height,10)-parseInt(M.height,10),parseInt(M.top,10))),I()):(e.showYScrollbar=!1,e.$emit("scrollbar.hide"),s.off("mousedown"),P(a[0]),a.attr("style","position:relative;top:0"),i.css({height:"100%"}))},z=function(t,o){null!=d&&clearTimeout(d);var n=!!o&&!!o.rollToBottom;d=setTimeout(function(){x.height=null,L(n),e.$$phase||e.$digest(),e.$parent.$$phase||e.$parent.$digest()},72)};L(),n.rebuildOn&&n.rebuildOn.split(" ").forEach(function(t){e.$on(t,z)}),n.hasOwnProperty("rebuildOnResize")&&m.on("resize",z)},template:'<div><div class="ngsb-wrap"><div class="ngsb-container" ng-transclude></div><div class="ngsb-scrollbar" style="position: absolute; display: block;" ng-show="showYScrollbar"><div class="ngsb-thumb-container"><div class="ngsb-thumb-pos" oncontextmenu="return false;"><div class="ngsb-thumb" ></div></div><div class="ngsb-track"></div></div></div></div></div>'}}]);
